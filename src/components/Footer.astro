---
import Button from './Button.astro';
import Icon from './Icon.astro';
import Logo from './Logo.astro';
import OptimizedImage from './OptimizedImage.astro';
import type { ImageMetadata } from 'astro';

interface Props {
  screen?: "Desktop" | "Mobile";
  className?: string;
  // Content props from CMS
  studioName?: string;
  headline?: string;
  description?: string;
  mapImage?: string | ImageMetadata;
  emailLabel?: string;
  emailDescription?: string;
  phoneLabel?: string;
  phoneDescription?: string;
  studioLabel?: string;
  email?: string;
  phone?: string;
  whatsAppUrl?: string;
  address?: string;
  privacyNote?: string;
  copyright?: string;
  buttonGoogleMaps?: string;
}

const { 
  screen = "Desktop", 
  className = "",
  studioName = "High Contrast Tattoo",
  headline = "In the heart of Friedrichshain",
  description = "We're located in Berlin's most vibrant creative neighborhood, where art lives in the streets and studios. Easy to reach, impossible to forget.",
  mapImage = "/images/footer/map.png",
  emailLabel = "Email",
  emailDescription = "Reach out anytime with questions",
  phoneLabel = "Phone",
  phoneDescription = "Call or message us directly",
  studioLabel = "Studio",
  email = "highcontrasttattoo@gmail.com",
  phone = "+49 176 72745645",
  whatsAppUrl = "https://wa.me/4917672745645",
  address = "Schreinerstraße 6, 10247 Berlin, Germany",
  privacyNote = "We use cookies for analytics and advertising only when you consent. You can change your cookie settings anytime. Details in our Privacy Policy.",
  copyright = "© 2026 High Contrast Tattoo",
  buttonGoogleMaps = "Open in Google Maps"
} = Astro.props;

// Build Google Maps URL from address
const googleMapsUrl = `https://maps.google.com/?q=${encodeURIComponent(`High Contrast Tattoo, ${address}`)}`;

// Get current path to determine active nav item
const currentPath = Astro.url.pathname;

// Embed Cookie settings link in the privacy note text
const cookieLink = '<a href="#cookie-settings" class="footer-link">cookie settings</a>';
const privacyNoteWithLink = (privacyNote || '')
  .replace(/\bcookie settings\b/gi, (match) => cookieLink.replace('cookie settings', match));

// Check if a nav link is active (homepage "/" maps to "/studio")
// Note: Template pages (/artists/[slug] and /styles/[slug]) should not mark nav links as active
const isActive = (href: string) => {
  if (href === '/studio' && (currentPath === '/' || currentPath === '/studio')) {
    return true;
  }
  // For /artists and /styles, only match exact paths, not template pages
  if (href === '/artists' || href === '/styles') {
    return currentPath === href;
  }
  return currentPath === href || currentPath.startsWith(href + '/');
};
---

<footer class={`footer footer-${screen.toLowerCase()} ${className}`} data-screen={screen}>
  <div class="container">
    <div class="text-block">
      <h2>{headline}</h2>
      <p class="body-lg">{description}</p>
    </div>
    <div class="map-block">
      <div class="contact-wrapper">
        <div class="contact-content">
          <div class="contact-item">
            <Icon name="mail" size={24} class="icon" />
            <h6>{emailLabel}</h6>
            <p>{emailDescription}</p>
            <a href={`mailto:${email}`} class="contact-link">{email}</a>
          </div>
          <div class="contact-item">
            <Icon name="device-phone" size={24} class="icon" />
            <h6>{phoneLabel}</h6>
            <p>{phoneDescription}</p>
            <div class="phone-links">
              <a href={`tel:${phone.replace(/\s/g, '')}`} class="contact-link">{phone}</a>
              <span class="separator">|</span>
              <a href={whatsAppUrl} class="contact-link">WhatsApp</a>
            </div>
          </div>
          <div class="contact-item">
            <Icon name="home" size={24} class="icon" />
            <h6>{studioLabel}</h6>
            <p>{address}</p>
          </div>
        </div>
        <div class="actions">
          <Button 
            type="Primary" 
            color="Primary" 
            href={googleMapsUrl} 
            leadingIcon={false} 
            trailingIcon={true}
            trailingIconName="open"
            target="_blank"
            rel="noopener noreferrer"
          >
            {buttonGoogleMaps}
          </Button>
        </div>
      </div>
      <div class="map-image">
        <OptimizedImage
          src={mapImage}
          alt={`Map of ${studioName} studio location`}
          className="map-placeholder"
          widths={[400, 800, 1200]}
          sizes="(max-width: 767px) 100vw, 50vw"
          loading="lazy"
          quality={85}
        />
      </div>
    </div>
  </div>
  <div class="container">
    <div class="logo-section">
      <div class="logo-wrapper">
        <Logo class="logo" />
      </div>
      <span class="logo-text">{studioName}</span>
    </div>
    <nav class="footer-nav">
      <a href="/" class={`nav-link ${isActive('/studio') ? 'nav-link--active' : ''}`}>Studio</a>
      <a href="/artists" class={`nav-link ${isActive('/artists') ? 'nav-link--active' : ''}`}>Artists</a>
      <a href="/styles" class={`nav-link ${isActive('/styles') ? 'nav-link--active' : ''}`}>Styles</a>
      <a href="/impressum" class={`nav-link ${isActive('/impressum') ? 'nav-link--active' : ''}`}>Imprint</a>
      <a href="/privacy" class={`nav-link ${isActive('/privacy') ? 'nav-link--active' : ''}`}>Privacy note</a>
    </nav>
    <div class="footer-text">
      <p class="footer-small" set:html={privacyNoteWithLink} />
      <p class="footer-copyright">{copyright}</p>
    </div>
  </div>
</footer>

<style>
  .footer {
    width: 100%;
    background-color: var(--color-neutral-50);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border-top: 1px solid var(--color-neutral-200);
  }

  /* Desktop Footer */
  .footer-desktop {
    gap: var(--spacing-core-1100-md);
    padding: var(--spacing-core-1100-md) 0;
  }

  /* Mobile Footer */
  .footer-mobile {
    gap: var(--spacing-core-900-md);
    padding: var(--spacing-core-1100-md) 0;
  }


  .text-block {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-core-700-md);
    align-items: flex-start;
    max-width: 640px;
    width: 100%;
  }

  .text-block h2 {
    font: var(--typography-h2);
    color: var(--color-primary-900);
    margin: 0;
  }

  .body-lg {
    font: var(--typography-body-lg);
    color: var(--color-primary-600);
    margin: 0;
  }

  .map-block {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-core-900-md);
    align-items: stretch;
    width: 100%;
  }

  .contact-wrapper {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    width: 416px;
  }

  .contact-content {
    display: flex;
    flex-direction: column;
    gap: 24px;
    align-items: flex-start;
    width: 100%;
  }

  .contact-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-core-500-md);
    align-items: flex-start;
    width: 100%;
  }

  .icon {
    width: 24px;
    height: 24px;
    color: var(--color-primary-600);
  }

  .contact-item h6 {
    font: var(--typography-h6);
    color: var(--color-text);
    margin: 0;
  }

  .contact-item p {
    font: var(--typography-body-md);
    color: var(--color-text);
    margin: 0;
  }

  .contact-link {
    font: var(--typography-body-md);
    color: var(--color-primary-900);
    text-decoration: underline;
  }

  .phone-links {
    display: flex;
    gap: 8px;
    align-items: flex-start;
  }

  .separator {
    font: var(--typography-body-md);
    color: var(--color-primary-600);
  }

  .actions {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding-top: var(--spacing-core-900-md);
    width: 100%;
  }

  .map-image {
    flex: 1;
    min-width: var(--spacing-core-1500-md);
    min-height: var(--spacing-core-1500-md);
    width: 100%;
    position: relative;
  }

  .map-image :global(img),
  .map-image :global(picture) {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  .footer .container:last-of-type {
    gap: var(--spacing-core-800-md);
  }

  .footer .container:first-of-type {
    gap: var(--spacing-core-900-md);
  }

  .logo-section {
    display: flex;
    gap: var(--spacing-core-700-md);
    align-items: center;
  }

  .logo-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    transform: scaleY(-1);
    color: var(--color-primary-900);
  }

  .logo {
    width: 16.513px;
    height: 36px;
    display: block;
  }

  .logo-text {
    font: var(--typography-body-lg);
    color: var(--color-primary-900);
  }

  .footer-nav {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-core-900-md);
    row-gap: 0;
    align-items: center;
    width: 100%;
  }

  /* nav-link styles are now in tokens.css */

  .footer-text {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-core-300-md);
    align-items: flex-start;
    width: 100%;
    font: var(--typography-body-sm);
    color: var(--color-primary-600);
  }

  .footer-small {
    font: var(--typography-body-sm);
    color: var(--color-primary-600);
    margin: 0;
  }

  .footer-link {
    font-size: 12px;
    font-weight: inherit;
    line-height: inherit;
    color: var(--color-primary-900);
    text-decoration: underline;
  }

  .footer-copyright {
    font: var(--typography-body-sm);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary-600);
    margin: 0;
  }

  @media (max-width: 768px) {
    .footer {
      border-top-color: var(--color-neutral-300);
    }

    .map-block {
      flex-direction: column;
    }

    .contact-wrapper {
      width: 100%;
    }

    .map-image {
      width: 100%;
    }
  }
</style>
