---
import Tag from './Tag.astro';
import OptimizedImage from './OptimizedImage.astro';
import imagePlaceholder from '../assets/images/image-placeholder.png';

interface Props {
  image?: string;
  imageAlt?: string;
  tags?: Array<{
    text: string;
    color?: "Primary" | "Accent" | "Neutral";
    href?: string;
  }>;
  className?: string;
}

const { 
  image,
  imageAlt = "Image with tags",
  tags = [],
  className = ""
} = Astro.props;
---

<div class={`image-with-tags ${className}`}>
  <div class="image-container">
    <OptimizedImage
      src={image || imagePlaceholder.src}
      alt={imageAlt}
      widths={[600, 1200, 1920]}
      sizes="100vw"
      loading="lazy"
      className="image-with-tags-img"
      fallbackSrc={imagePlaceholder.src}
      quality={85}
    />
  </div>
  {tags.length > 0 && (
    <div class="tags-container">
      {tags.map((tag) => (
        <Tag color={tag.color || "Accent"} href={tag.href}>{tag.text}</Tag>
      ))}
    </div>
  )}
</div>

<style>
  .image-with-tags {
    position: relative;
    width: 100%;
    display: flex;
    flex-direction: column;
  }

  .image-container {
    position: relative;
    width: 100%;
    min-height: 0;
  }

  .image-container :global(img),
  .image-container :global(picture) {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: 50% 50%;
    display: block;
  }

  .image-container :global(img) {
    width: 100%;
    height: 100%;
  }


  .tags-container {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-core-500-md);
    padding: var(--spacing-core-500-md);
    pointer-events: none;
  }

  .tags-container :global(.tag) {
    pointer-events: auto;
  }
</style>
