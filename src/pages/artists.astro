---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Divider from '../components/Divider.astro';
import ArtistsHeroSection from '../components/sections/ArtistsHeroSection.astro';
import ArtistDetailSection from '../components/sections/ArtistDetailSection.astro';
import { getCollection } from 'astro:content';
import { getSlug, resolveStyleNames, worksToGalleryImages, getWorksByArtist } from '../utils/contentHelpers';

const artistEntries = await getCollection('artists');
const styleEntries = await getCollection('styles');
const works = await getCollection('works');

const artists = artistEntries.map(entry => {
  const artistWorks = getWorksByArtist(entry.data.id, works);
  return {
    name: entry.data.name,
    slug: getSlug(entry),
    intro: entry.data.intro,
    photo: entry.data.photo,
    styles: resolveStyleNames(entry.data.styles, styleEntries),
    galleryImages: worksToGalleryImages(artistWorks, entry.data.name, styleEntries),
  };
});
---

<Layout>
  <Header />
  <main>
    <ArtistsHeroSection />
    
    <Divider color="light" />
    
    {artists.map((artist, index) => (
      <>
        <ArtistDetailSection
          name={artist.name}
          slug={artist.slug}
          intro={artist.intro}
          photo={artist.photo}
          styles={artist.styles}
          galleryImages={artist.galleryImages}
        />
        {index < artists.length - 1 && <Divider color="light" />}
      </>
    ))}
    
    <Divider color="light" />
  </main>
  <Footer />
</Layout>

<style>
  main {
    width: 100%;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-x: visible;
    overflow-y: visible;
    padding-top: 72px; /* Account for fixed header height */
  }
</style>
