---
import Gallery from '../Gallery.astro';
import Button from '../Button.astro';

interface GalleryImage {
  src: string;
  alt?: string;
  tags?: Array<{
    text: string;
    color?: "Primary" | "Accent" | "Neutral";
  }>;
}

interface Props {
  galleryImages?: GalleryImage[];
  details?: string;
  showBackLink?: boolean;
  className?: string;
}

const {
  galleryImages = [],
  details,
  showBackLink = true,
  className = ""
} = Astro.props;

// Parse details markdown into sections separated by ---
function parseDetails(detailsText: string | undefined) {
  if (!detailsText) return [];
  
  return detailsText
    .split(/\n---\n/)
    .map(section => section.trim())
    .filter(section => section.length > 0);
}

const detailSections = parseDetails(details);
---

<section class={`style-content-section ${className}`}>
  <div class="container">
    <!-- Main Gallery -->
    {galleryImages.length > 0 && (
      <div class="main-gallery-wrapper">
        <Gallery images={galleryImages} maxVisible={9} />
      </div>
    )}

    <!-- Details Content -->
    {detailSections.length > 0 && (
      <div class="details-content">
        {detailSections.map((section) => (
          <div class="detail-section">
            <p class="detail-paragraph" set:html={section.replace(/\n/g, '<br>')} />
          </div>
        ))}
      </div>
    )}

    <!-- Back Link -->
    {showBackLink && (
      <div class="back-link-wrapper">
        <Button
          type="Secondary"
          color="Primary"
          href="/styles"
          leadingIcon={true}
          leadingIconName="chevron-left"
          trailingIcon={false}
        >
          Explore all styles
        </Button>
      </div>
    )}
  </div>
</section>

<style>
  .style-content-section {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: transparent;
    padding: var(--spacing-core-1100-md) 0;
    /* Overlap with hero section by -144px */
    margin-top: calc(-1 * var(--spacing-core-1300-lg));
    position: relative;
    z-index: 1;
  }

  .style-content-section :global(.container) {
    gap: var(--spacing-core-1100-md);
  }

  /* Main Gallery */
  .main-gallery-wrapper {
    width: 100%;
  }

  /* Details Content */
  .details-content {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-core-900-md);
    width: 100%;
    max-width: 640px;
  }

  .detail-section {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-core-700-md);
  }

  .detail-paragraph {
    font: var(--typography-body-md);
    color: var(--color-primary-900);
    margin: 0;
    font-weight: var(--font-weight-light);
    line-height: var(--line-height-core-800-md);
  }

  /* Back Link */
  .back-link-wrapper {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    width: 100%;
    padding-top: var(--spacing-core-700-md);
  }

  /* Override the chevron-left icon rotation in the secondary button */
  .back-link-wrapper :global(.icon-leading .icon svg) {
    transform: rotate(-90deg) scaleY(-1);
  }

  /* Mobile Layout */
  @media (max-width: 767px) {
    .style-content-section {
      padding: var(--spacing-core-900-md) 0;
    }

    .style-content-section :global(.container) {
      gap: var(--spacing-core-900-md);
    }

    .details-content {
      gap: var(--spacing-core-700-md);
    }

    .detail-paragraph {
      font: var(--typography-body-md);
    }

    .back-link-wrapper {
      padding-top: var(--spacing-core-500-md);
    }
  }
</style>
