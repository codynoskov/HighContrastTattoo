---
import Gallery from '../Gallery.astro';
import Button from '../Button.astro';
import Lightbox from '../Lightbox.astro';

interface GalleryImage {
  src: string;
  alt?: string;
  tags?: Array<{
    text: string;
    color?: "Primary" | "Accent" | "Neutral";
  }>;
}

interface Props {
  galleryImages?: GalleryImage[];
  showBackLink?: boolean;
  hasBodyContent?: boolean;
  className?: string;
}

const {
  galleryImages = [],
  showBackLink = true,
  hasBodyContent = false,
  className = ""
} = Astro.props;

// Generate a single shared gallery ID for all images on this page
const sharedGalleryId = `style-gallery-${Math.random().toString(36).substring(2, 11)}`;

// Split gallery images: first 3 for the top row, rest after body content
const firstRowImages = galleryImages.slice(0, 3);
const remainingImages = galleryImages.slice(3);
---

<section class={`style-content-section ${className}`}>
  <div class="container">
    <!-- First Gallery Row (3 images) -->
    {firstRowImages.length > 0 && (
      <div class="gallery-wrapper first-gallery-row">
        <Gallery 
          images={firstRowImages} 
          maxVisible={3} 
          sharedGalleryId={sharedGalleryId}
          imageOffset={0}
        />
      </div>
    )}

    <!-- Body Content (rendered markdown from content collection) -->
    {hasBodyContent && (
      <div class="body-content">
        <slot />
      </div>
    )}

    <!-- Remaining Gallery Images -->
    {remainingImages.length > 0 && (
      <div class="gallery-wrapper remaining-gallery">
        <Gallery 
          images={remainingImages} 
          maxVisible={remainingImages.length} 
          sharedGalleryId={sharedGalleryId}
          imageOffset={firstRowImages.length}
        />
      </div>
    )}

    <!-- Back Link -->
    {showBackLink && (
      <div class="back-link-wrapper">
        <Button
          type="Secondary"
          color="Primary"
          href="/styles"
          leadingIcon={true}
          leadingIconName="chevron-left"
          trailingIcon={false}
        >
          Explore all styles
        </Button>
      </div>
    )}
  </div>
  
  <!-- Single shared lightbox for all images -->
  {galleryImages.length > 0 && (
    <Lightbox images={galleryImages} galleryId={sharedGalleryId} />
  )}
</section>

<style>
  .style-content-section {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: transparent;
    padding: var(--spacing-core-1100-md) 0;
    /* Overlap with hero section by -144px */
    margin-top: calc(-1 * var(--spacing-core-1300-lg));
    position: relative;
    z-index: 1;
  }

  .style-content-section :global(.container) {
    gap: 10px;
  }

  /* Gallery */
  .gallery-wrapper {
    width: 100%;
  }

  /* Body Content (rendered markdown from collection) */
  .body-content {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-core-900-md);
    width: 100%;
    max-width: 640px;
    padding: var(--spacing-core-900-md) 0;
    color: var(--color-primary-900);
  }

  .body-content :global(p) {
    font: var(--typography-body-md);
    color: var(--color-primary-900);
    margin: 0 0 var(--spacing-core-700-md) 0;
    font-weight: var(--font-weight-light);
    line-height: var(--line-height-core-800-md);
  }

  .body-content :global(p:last-child) {
    margin-bottom: 0;
  }

  .body-content :global(h2) {
    font: var(--typography-h2);
    color: var(--color-primary-900);
    margin: var(--spacing-core-900-md) 0 var(--spacing-core-700-md) 0;
  }

  .body-content :global(h2:first-child) {
    margin-top: 0;
  }

  .body-content :global(strong) {
    font-weight: var(--font-weight-bold);
  }

  .body-content :global(em) {
    font-style: italic;
  }

  .body-content :global(a) {
    color: var(--color-primary-900);
    text-decoration: underline;
    text-underline-position: from-font;
  }

  .body-content :global(a:hover) {
    color: var(--color-primary-700);
  }

  /* Back Link */
  .back-link-wrapper {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    width: 100%;
    padding-top: var(--spacing-core-900-md);
  }

  /* Override the chevron-left icon rotation in the secondary button */
  .back-link-wrapper :global(.icon-leading .icon svg) {
    transform: rotate(-90deg) scaleY(-1);
  }

  /* Mobile Layout */
  @media (max-width: 767px) {
    .style-content-section {
      padding: var(--spacing-core-900-md) 0;
    }

    .style-content-section :global(.container) {
      gap: var(--spacing-core-500-md);
    }

    .body-content {
      gap: var(--spacing-core-700-md);
      padding: var(--spacing-core-700-md) 0;
    }

    .back-link-wrapper {
      padding-top: var(--spacing-core-500-md);
    }
  }
</style>
