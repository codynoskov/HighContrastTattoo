---
import Card from '../Card.astro';
import Button from '../Button.astro';
import placeholderImage from '../../assets/images/artist-placeholder.png';
import { getCollection } from 'astro:content';
import { getSlug, resolveImagePath, resolveStyleNames } from '../../utils/contentHelpers';

interface Props {
  title?: string;
  description?: string;
  ctaText?: string;
  ctaHref?: string;
  className?: string;
}

// Fetch content collections
const artistEntries = await getCollection('artists');
const worksEntries = await getCollection('works');
const styleEntries = await getCollection('styles');

// Transform artists into card format
const artistsData = artistEntries.map((entry) => {
  const slug = getSlug(entry);
  
  // Get works by this artist to determine their styles
  const artistWorks = worksEntries.filter(work => work.data.artist === slug);
  
  // Collect all unique styles from artist's works
  const allStyleSlugs = [...new Set(artistWorks.flatMap(work => work.data.styles))];
  const styleNames = resolveStyleNames(allStyleSlugs, styleEntries);
  
  return {
    title: entry.data.name,
    description: entry.data.intro,
    image: resolveImagePath(entry.data.photo) || placeholderImage.src,
    artistTags: styleNames,
    href: `/artists/${slug}`
  };
});

const {
  title = "Meet the Artists",
  description = "Our team brings years of experience across many tattoo styles. Explore portfolios and find the right artist for your idea.",
  ctaText = "Meet all our Artists",
  ctaHref = "/artists",
  className = ""
} = Astro.props;
---

<section class={`section section--carousel ${className}`}>
  <div class="container">
    <div class="section-text-block">
      <h2 class="section-title">{title}</h2>
      <p class="section-description">{description}</p>
    </div>
  </div>
  
  <div class="carousel-wrapper" style="margin-top: var(--spacing-core-900-md);">
    <div class="carousel">
      <div class="carousel-track">
        {artistsData.map((artist, index) => {
          const sizes: ("sm" | "md" | "lg")[] = ["lg", "md", "sm", "lg"];
          const descriptionSize = sizes[index % sizes.length] || "md";
          return (
            <Card 
              type="Artist"
              fillHeight={false}
              title={artist.title}
              description={artist.description}
              descriptionSize={descriptionSize}
              image={artist.image}
              artistTags={artist.artistTags}
              href={artist.href}
            />
          );
        })}
      </div>
    </div>
  </div>
  
  <div class="container">
    <div class="section-action">
      <Button 
        type="Primary" 
        color="Primary"
        href={ctaHref}
        leadingIcon={false}
        trailingIcon={true}
        trailingIconName="chevron-right"
      >
        {ctaText}
      </Button>
    </div>
  </div>
</section>

<style>
  /* All styles now handled by .section--carousel in tokens.css */
</style>
