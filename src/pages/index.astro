---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Divider from '../components/Divider.astro';
import HeroSection from '../components/sections/HeroSection.astro';
import ReviewsSection from '../components/sections/ReviewsSection.astro';
import InstagramPromoSection from '../components/sections/InstagramPromoSection.astro';
import StudioSection from '../components/sections/StudioSection.astro';
import WalkInTattoosSection from '../components/sections/WalkInTattoosSection.astro';
import StylesSection from '../components/sections/StylesSection.astro';
import ArtistsSection from '../components/sections/ArtistsSection.astro';
import ValuesSection from '../components/sections/ValuesSection.astro';
import { getCollection } from 'astro:content';
import { resolveImagePath } from '../utils/contentHelpers';

// Get homepage content
const homepageEntries = await getCollection('homepage');
const homepage = homepageEntries[0]?.data || {};

// Get settings content
const settingsEntries = await getCollection('settings');
const settings = settingsEntries[0]?.data || {};

// Resolve image and video paths (handles R2 URLs automatically)
const topRightImage = homepage.topRightImage ? resolveImagePath(homepage.topRightImage) : undefined;
const bottomLeftImage = homepage.bottomLeftImage ? resolveImagePath(homepage.bottomLeftImage) : undefined;
const videoSrc = homepage.videoSrc ? resolveImagePath(homepage.videoSrc) : undefined;
const instagramBgImage = homepage.instagramBackgroundImage ? resolveImagePath(homepage.instagramBackgroundImage) : undefined;
const walkInBgImage = homepage.walkInBackgroundImage ? resolveImagePath(homepage.walkInBackgroundImage) : undefined;
const footerMapImage = settings.footerMapImage ? resolveImagePath(settings.footerMapImage) : undefined;

// SEO - Homepage uses custom values or falls back to global defaults
const seoTitle = homepage.metaTitle || settings.seoSiteName || 'High Contrast Tattoo Berlin';
const seoDescription = homepage.metaDescription || settings.seoDefaultDescription;
const seoOgImage = homepage.ogImage || settings.seoDefaultOgImage;
---

<Layout
	title={seoTitle}
	description={seoDescription}
	ogImage={seoOgImage}
	includeLocalBusiness={true}
>
	<Header 
		studioName={settings.studioName}
		buttonBookSession={settings.buttonBookSession}
	/>
	<main>
		<HeroSection 
			headline={homepage.headline}
			introText={homepage.introText}
			ctaText={settings.buttonBookSession}
			ctaHref="/book"
			videoSrc={videoSrc}
			streamVideoId={homepage.streamVideoId}
			streamCustomerCode={homepage.streamCustomerCode}
			topRightImage={topRightImage}
			bottomLeftImage={bottomLeftImage}
		/>
		<ReviewsSection 
			title={homepage.reviewsTitle}
			subtitle={homepage.reviewsSubtitle}
			buttonText={settings.buttonGoogleMaps}
		/>
		<Divider />
		<InstagramPromoSection 
			title={homepage.instagramTitle}
			instagramHandle={homepage.instagramHandle}
			instagramUrl={homepage.instagramUrl}
			backgroundImage={instagramBgImage}
			buttonText={settings.buttonInstagram}
		/>
		<Divider />
		<StudioSection 
			title={homepage.studioTitle}
			description={homepage.studioDescription}
		/>
		<Divider />
		<WalkInTattoosSection 
			title={homepage.walkInTitle}
			description={homepage.walkInDescription}
			schedule={homepage.walkInSchedule}
			backgroundImage={walkInBgImage}
			buttonText={settings.buttonGoogleMaps}
		/>
		<Divider />
		<StylesSection 
			title={homepage.stylesTitle}
			description={homepage.stylesDescription}
			ctaText={homepage.stylesCtaText}
		/>
		<Divider />
		<ValuesSection 
			title={homepage.valuesTitle}
			description={homepage.valuesDescription}
		/>
		<Divider />
		<ArtistsSection 
			title={homepage.artistsTitle}
			description={homepage.artistsDescription}
			ctaText={homepage.artistsCtaText}
		/>
		<Divider />
	</main>
	<Footer 
		studioName={settings.studioName}
		headline={settings.footerHeadline}
		description={settings.footerDescription}
		mapImage={footerMapImage}
		emailLabel={settings.footerEmailLabel}
		emailDescription={settings.footerEmailDescription}
		phoneLabel={settings.footerPhoneLabel}
		phoneDescription={settings.footerPhoneDescription}
		studioLabel={settings.footerStudioLabel}
		email={settings.footerEmail}
		phone={settings.footerPhone}
		whatsAppUrl={settings.footerWhatsAppUrl}
		address={settings.footerAddress}
		privacyNote={settings.footerPrivacyNote}
		copyright={settings.footerCopyright}
		buttonGoogleMaps={settings.buttonGoogleMaps}
	/>
</Layout>

<style>
	main {
		width: 100%;
		min-height: 100vh;
		display: flex;
		flex-direction: column;
		align-items: center;
		overflow-x: visible;
		overflow-y: visible;
		padding-top: 72px; /* Account for fixed header height */
	}
</style>
